@startuml Torque Runner Structure
!theme plain
skinparam backgroundColor #FFFFFF
skinparam defaultFontSize 12
skinparam classAttributeIconSize 0

title Torque Runner - Class Structure

package "Torque_runner.py" {
    class TorqueRunner {
        - mapper: TorqueMapper
        + __init__()
        + run_dsl(torque_command: str, X: np.ndarray, y: np.ndarray, ...): Dict
        + run_from_json(json_file: str, X: np.ndarray, y: np.ndarray, ...): Dict
        + run_ast(ast: Dict, X: np.ndarray, y: np.ndarray, ...): Dict
        + load_config(config_file: str): Dict
        + load_data_from_config(config: Dict): Tuple
        - _run_and_evaluate(estimator: Any, X: np.ndarray, y: np.ndarray, ...): Dict
        - _calculate_all_metrics(y_true: np.ndarray, y_pred: np.ndarray, y_pred_proba: np.ndarray): Dict
        - _run_cross_validation(estimator: Any, X: np.ndarray, y: np.ndarray, ...): Dict
    }
}

package "Dependencies" {
    class TorqueMapper {
        + export_to_json(...): Dict
        + dsl_to_ast(...): Dict
    }
    
    class compiler {
        + compile_ast_to_estimator(ast: Dict): Any
    }
    
    class sklearn {
        + train_test_split(...)
        + cross_val_score(...)
        + accuracy_score(...)
        + precision_score(...)
        + recall_score(...)
        + f1_score(...)
        + roc_auc_score(...)
        + confusion_matrix(...)
        + classification_report(...)
    }
}

package "Input" {
    class ConfigFile {
        + torque_command: str
        + data: Dict
        + splitting: Dict
        + evaluation: Dict
        + output: Dict
    }
    
    class CSVData {
        + file: str
        + target_column: str
    }
}

package "Output" {
    class MetricsJSON {
        + timestamp: str
        + source: Dict
        + data_info: Dict
        + metrics: Dict
        + cross_validation: Dict
        + confusion_matrix: Dict
        + classification_report: Dict
        + status: str
    }
}

TorqueRunner --> TorqueMapper : uses
TorqueRunner --> compiler : uses
TorqueRunner --> sklearn : uses
TorqueRunner --> ConfigFile : reads
TorqueRunner --> CSVData : reads
TorqueRunner --> MetricsJSON : creates

note right of TorqueRunner
  **Main Responsibilities:**
  1. Load config and data
  2. Call Torque_mapper internally
  3. Execute Python code
  4. Train and evaluate model
  5. Calculate all metrics
  6. Export results to JSON
end note

note right of MetricsJSON
  **Output Format:**
  - Torque_runner_result.json
  - Contains comprehensive ML metrics
  - Includes CV, confusion matrix, etc.
end note

@enduml
