<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1599px" preserveAspectRatio="none" style="width:1655px;height:1599px;" version="1.1" viewBox="0 0 1655 1599" width="1655px" zoomAndPan="magnify"><defs><filter height="300%" id="f189r6s9b20454" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="338" x="655" y="31.2419">Parser and Compiler Sequence Diagram</text><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="218.9421" style="stroke:#A80036;stroke-width:1.0;" width="10" x="283.5" y="218.1995"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="31.706" style="stroke:#A80036;stroke-width:1.0;" width="10" x="283.5" y="546.2597"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="963.4564" style="stroke:#A80036;stroke-width:1.0;" width="10" x="501.5" y="514.5537"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="836.6323" style="stroke:#A80036;stroke-width:1.0;" width="10" x="747.5" y="609.6717"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="31.706" style="stroke:#A80036;stroke-width:1.0;" width="10" x="752.5" y="1103.2439"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="328.0602" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1010.5" y="668.0838"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="362.7662" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198.5" y="1044.8318"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="790.9263" style="stroke:#000000;stroke-width:2.0;" width="1002.5" x="635.5" y="624.6717"/><rect fill="#FFFFFF" height="411.4541" style="stroke:none;stroke-width:1.0;" width="1002.5" x="635.5" y="1004.1439"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="83.118" style="stroke:#000000;stroke-width:2.0;" width="618.5" x="645.5" y="1059.8318"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="138.7875" y2="1496.0101"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="288.5" x2="288.5" y1="138.7875" y2="1496.0101"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="506.5" x2="506.5" y1="138.7875" y2="1496.0101"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="752.5" x2="752.5" y1="138.7875" y2="1496.0101"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1015" x2="1015" y1="138.7875" y2="1496.0101"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1203" x2="1203" y1="138.7875" y2="1496.0101"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1402" x2="1402" y1="138.7875" y2="1496.0101"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1560" x2="1560" y1="138.7875" y2="1496.0101"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="134.6855">User</text><ellipse cx="23.5" cy="62.7196" fill="#FEFECE" filter="url(#f189r6s9b20454)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M23.5,70.7196 L23.5,97.7196 M10.5,78.7196 L36.5,78.7196 M23.5,97.7196 L10.5,112.7196 M23.5,97.7196 L36.5,112.7196 " fill="none" filter="url(#f189r6s9b20454)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="1509.976">User</text><ellipse cx="23.5" cy="1524.078" fill="#FEFECE" filter="url(#f189r6s9b20454)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M23.5,1532.078 L23.5,1559.078 M10.5,1540.078 L36.5,1540.078 M23.5,1559.078 L10.5,1574.078 M23.5,1559.078 L36.5,1574.078 " fill="none" filter="url(#f189r6s9b20454)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="82" x="245.5" y="100.7196"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="252.5" y="122.6855">DSLParser</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="82" x="245.5" y="1495.0101"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="252.5" y="1516.976">DSLParser</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="186" x="411.5" y="100.7196"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="418.5" y="122.6855">dsl_to_sklearn_estimator()</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="186" x="411.5" y="1495.0101"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="418.5" y="1516.976">dsl_to_sklearn_estimator()</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="190" x="655.5" y="100.7196"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="662.5" y="122.6855">compile_ast_to_estimator()</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="190" x="655.5" y="1495.0101"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="662.5" y="1516.976">compile_ast_to_estimator()</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="105" x="961" y="100.7196"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="968" y="122.6855">build_model()</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="105" x="961" y="1495.0101"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="968" y="1516.976">build_model()</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="90.2717" style="stroke:#A80036;stroke-width:1.5;" width="97" x="1153" y="43.5158"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="1163" y="65.4818">build_vote()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="1160" y="84.5497">build_stack()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="1164" y="103.6176">build_bag()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="1164.5" y="122.6855">build_ada()</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="90.2717" style="stroke:#A80036;stroke-width:1.5;" width="97" x="1153" y="1495.0101"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="1163" y="1516.976">build_vote()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="1160" y="1536.0439">build_stack()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="1164" y="1555.1118">build_bag()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="1164.5" y="1574.1797">build_ada()</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="52.1358" style="stroke:#A80036;stroke-width:1.5;" width="157" x="1322" y="81.6517"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="1340.5" y="103.6176">MODEL_REGISTRY</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143" x="1329" y="122.6855">ENSEMBLE_REGISTRY</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="52.1358" style="stroke:#A80036;stroke-width:1.5;" width="157" x="1322" y="1495.0101"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="1340.5" y="1516.976">MODEL_REGISTRY</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143" x="1329" y="1536.0439">ENSEMBLE_REGISTRY</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="131" x="1493" y="100.7196"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="1500" y="122.6855">sklearn Estimator</text><rect fill="#FEFECE" filter="url(#f189r6s9b20454)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="131" x="1493" y="1495.0101"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="1500" y="1516.976">sklearn Estimator</text><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="218.9421" style="stroke:#A80036;stroke-width:1.0;" width="10" x="283.5" y="218.1995"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="31.706" style="stroke:#A80036;stroke-width:1.0;" width="10" x="283.5" y="546.2597"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="963.4564" style="stroke:#A80036;stroke-width:1.0;" width="10" x="501.5" y="514.5537"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="836.6323" style="stroke:#A80036;stroke-width:1.0;" width="10" x="747.5" y="609.6717"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="31.706" style="stroke:#A80036;stroke-width:1.0;" width="10" x="752.5" y="1103.2439"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="328.0602" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1010.5" y="668.0838"/><rect fill="#FFFFFF" filter="url(#f189r6s9b20454)" height="362.7662" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198.5" y="1044.8318"/><rect fill="#EEEEEE" filter="url(#f189r6s9b20454)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1648" x="0" y="170.6405"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1648" y1="170.6405" y2="170.6405"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1648" y1="173.6405" y2="173.6405"/><rect fill="#EEEEEE" filter="url(#f189r6s9b20454)" height="25.706" style="stroke:#000000;stroke-width:2.0;" width="167" x="740.5" y="158.7875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="150" x="746.5" y="176.6845">Parse DSL String to AST</text><polygon fill="#A80036" points="271.5,214.1995,281.5,218.1995,271.5,222.1995,275.5,218.1995" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="277.5" y1="218.1995" y2="218.1995"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="30.5" y="212.3905">parse(dsl_string)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="293.5" x2="335.5" y1="267.6116" y2="267.6116"/><line style="stroke:#A80036;stroke-width:1.0;" x1="335.5" x2="335.5" y1="267.6116" y2="280.6116"/><line style="stroke:#A80036;stroke-width:1.0;" x1="294.5" x2="335.5" y1="280.6116" y2="280.6116"/><polygon fill="#A80036" points="304.5,276.6116,294.5,280.6116,304.5,284.6116,300.5,280.6116" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="300.5" y="244.0966">_setup_grammar()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="300.5" y="261.8026">(if first call)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="293.5" x2="335.5" y1="312.3176" y2="312.3176"/><line style="stroke:#A80036;stroke-width:1.0;" x1="335.5" x2="335.5" y1="312.3176" y2="325.3176"/><line style="stroke:#A80036;stroke-width:1.0;" x1="294.5" x2="335.5" y1="325.3176" y2="325.3176"/><polygon fill="#A80036" points="304.5,321.3176,294.5,325.3176,304.5,329.3176,300.5,325.3176" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="300.5" y="306.5086">grammar.parseString(dsl_string)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="293.5" x2="335.5" y1="374.7296" y2="374.7296"/><line style="stroke:#A80036;stroke-width:1.0;" x1="335.5" x2="335.5" y1="374.7296" y2="387.7296"/><line style="stroke:#A80036;stroke-width:1.0;" x1="294.5" x2="335.5" y1="387.7296" y2="387.7296"/><polygon fill="#A80036" points="304.5,383.7296,294.5,387.7296,304.5,391.7296,300.5,387.7296" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="300.5" y="351.2146">_make_call_node() or</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="300.5" y="368.9206">_make_literal_node()</text><polygon fill="#A80036" points="34.5,433.1417,24.5,437.1417,34.5,441.1417,30.5,437.1417" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="287.5" y1="437.1417" y2="437.1417"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="40.5" y="413.6266">ast_node (dict)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="40.5" y="431.3327">{type: "call", name: "...", pos: [...], kw: {...}}</text><rect fill="#EEEEEE" filter="url(#f189r6s9b20454)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1648" x="0" y="466.9947"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1648" y1="466.9947" y2="466.9947"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1648" y1="469.9947" y2="469.9947"/><rect fill="#EEEEEE" filter="url(#f189r6s9b20454)" height="25.706" style="stroke:#000000;stroke-width:2.0;" width="224" x="712" y="455.1417"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="207" x="718" y="473.0387">Compile DSL String to Estimator</text><polygon fill="#A80036" points="489.5,510.5537,499.5,514.5537,489.5,518.5537,493.5,514.5537" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="495.5" y1="514.5537" y2="514.5537"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="30.5" y="508.7447">dsl_to_sklearn_estimator(dsl_string)</text><polygon fill="#A80036" points="304.5,542.2597,294.5,546.2597,304.5,550.2597,300.5,546.2597" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="298.5" x2="500.5" y1="546.2597" y2="546.2597"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="310.5" y="540.4507">parse_dsl_to_ast(dsl_string)</text><polygon fill="#A80036" points="489.5,573.9657,499.5,577.9657,489.5,581.9657,493.5,577.9657" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="288.5" x2="495.5" y1="577.9657" y2="577.9657"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="295.5" y="572.1567">ast_node (dict)</text><polygon fill="#A80036" points="735.5,605.6717,745.5,609.6717,735.5,613.6717,739.5,609.6717" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="741.5" y1="609.6717" y2="609.6717"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="518.5" y="603.8627">compile_ast_to_estimator(ast_node)</text><path d="M635.5,624.6717 L698.5,624.6717 L698.5,633.6717 L688.5,643.6717 L635.5,643.6717 L635.5,624.6717 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="790.9263" style="stroke:#000000;stroke-width:2.0;" width="1002.5" x="635.5" y="624.6717"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="650.5" y="639.5688">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="210" x="713.5" y="638.4307">[Node is a Model (LR, SVM, RF, DT, NB)]</text><polygon fill="#A80036" points="998.5,664.0838,1008.5,668.0838,998.5,672.0838,1002.5,668.0838" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="757.5" x2="1004.5" y1="668.0838" y2="668.0838"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="764.5" y="662.2748">build_model(name, kw_nodes, context)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1020.5" x2="1062.5" y1="699.7898" y2="699.7898"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1062.5" x2="1062.5" y1="699.7898" y2="712.7898"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1021.5" x2="1062.5" y1="712.7898" y2="712.7898"/><polygon fill="#A80036" points="1031.5,708.7898,1021.5,712.7898,1031.5,716.7898,1027.5,712.7898" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="1027.5" y="693.9808">eval_value() for each kw arg</text><polygon fill="#A80036" points="1390.5,740.4958,1400.5,744.4958,1390.5,748.4958,1394.5,744.4958" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1020.5" x2="1396.5" y1="744.4958" y2="744.4958"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="1027.5" y="738.6868">MODEL_REGISTRY[name]</text><polygon fill="#A80036" points="1031.5,772.2018,1021.5,776.2018,1031.5,780.2018,1027.5,776.2018" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1025.5" x2="1401.5" y1="776.2018" y2="776.2018"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="1037.5" y="770.3928">sklearn class</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1020.5" x2="1062.5" y1="825.6139" y2="825.6139"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1062.5" x2="1062.5" y1="825.6139" y2="838.6139"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1021.5" x2="1062.5" y1="838.6139" y2="838.6139"/><polygon fill="#A80036" points="1031.5,834.6139,1021.5,838.6139,1031.5,842.6139,1027.5,838.6139" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="1027.5" y="802.0988">safe_kwargs_for()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="1027.5" y="819.8049">(validate parameters)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1020.5" x2="1062.5" y1="888.0259" y2="888.0259"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1062.5" x2="1062.5" y1="888.0259" y2="901.0259"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1021.5" x2="1062.5" y1="901.0259" y2="901.0259"/><polygon fill="#A80036" points="1031.5,897.0259,1021.5,901.0259,1031.5,905.0259,1027.5,901.0259" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="1027.5" y="864.5109">Apply special rules</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="1027.5" y="882.2169">(e.g., LR penalty/solver)</text><polygon fill="#A80036" points="1548.5,928.7319,1558.5,932.7319,1548.5,936.7319,1552.5,932.7319" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1020.5" x2="1554.5" y1="932.7319" y2="932.7319"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="1027.5" y="926.9229">cls(**kw)</text><polygon fill="#A80036" points="1031.5,960.4379,1021.5,964.4379,1031.5,968.4379,1027.5,964.4379" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1025.5" x2="1559.5" y1="964.4379" y2="964.4379"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="1037.5" y="958.6289">sklearn estimator instance</text><polygon fill="#A80036" points="768.5,992.1439,758.5,996.1439,768.5,1000.1439,764.5,996.1439" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="762.5" x2="1014.5" y1="996.1439" y2="996.1439"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="774.5" y="990.3349">estimator</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="635.5" x2="1638" y1="1005.1439" y2="1005.1439"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="231" x="640.5" y="1016.9029">[Node is Ensemble (vote, stack, bag, ada)]</text><polygon fill="#A80036" points="1186.5,1040.8318,1196.5,1044.8318,1186.5,1048.8318,1190.5,1044.8318" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="757.5" x2="1192.5" y1="1044.8318" y2="1044.8318"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="764.5" y="1039.0228">build_* (pos_nodes, kw_nodes, context)</text><path d="M645.5,1059.8318 L718.5,1059.8318 L718.5,1068.8318 L708.5,1078.8318 L645.5,1078.8318 L645.5,1059.8318 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="83.118" style="stroke:#000000;stroke-width:2.0;" width="618.5" x="645.5" y="1059.8318"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="660.5" y="1074.7289">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="216" x="733.5" y="1073.5908">[For each base estimator in pos_nodes]</text><polygon fill="#A80036" points="773.5,1099.2439,763.5,1103.2439,773.5,1107.2439,769.5,1103.2439" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="767.5" x2="1197.5" y1="1103.2439" y2="1103.2439"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="779.5" y="1097.4349">compile_ast_to_estimator(child_node, context)</text><polygon fill="#A80036" points="1186.5,1130.9499,1196.5,1134.9499,1186.5,1138.9499,1190.5,1134.9499" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="757.5" x2="1192.5" y1="1134.9499" y2="1134.9499"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="764.5" y="1129.1409">base_estimator</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1208.5" x2="1250.5" y1="1173.6559" y2="1173.6559"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1250.5" x2="1250.5" y1="1173.6559" y2="1186.6559"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1209.5" x2="1250.5" y1="1186.6559" y2="1186.6559"/><polygon fill="#A80036" points="1219.5,1182.6559,1209.5,1186.6559,1219.5,1190.6559,1215.5,1186.6559" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="1215.5" y="1167.8469">eval_value() for options</text><polygon fill="#A80036" points="1390.5,1214.3619,1400.5,1218.3619,1390.5,1222.3619,1394.5,1218.3619" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1208.5" x2="1396.5" y1="1218.3619" y2="1218.3619"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="1215.5" y="1212.5529">ENSEMBLE_REGISTRY[name]</text><polygon fill="#A80036" points="1219.5,1246.0679,1209.5,1250.0679,1219.5,1254.0679,1215.5,1250.0679" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1213.5" x2="1401.5" y1="1250.0679" y2="1250.0679"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="1225.5" y="1244.2589">sklearn ensemble class</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1208.5" x2="1250.5" y1="1299.48" y2="1299.48"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1250.5" x2="1250.5" y1="1299.48" y2="1312.48"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1209.5" x2="1250.5" y1="1312.48" y2="1312.48"/><polygon fill="#A80036" points="1219.5,1308.48,1209.5,1312.48,1219.5,1316.48,1215.5,1312.48" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="1215.5" y="1275.965">safe_kwargs_for()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="1215.5" y="1293.671">(validate parameters)</text><polygon fill="#A80036" points="1548.5,1340.186,1558.5,1344.186,1548.5,1348.186,1552.5,1344.186" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1208.5" x2="1554.5" y1="1344.186" y2="1344.186"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="1215.5" y="1338.377">EnsembleClass(estimators=[...], **options)</text><polygon fill="#A80036" points="1219.5,1371.892,1209.5,1375.892,1219.5,1379.892,1215.5,1375.892" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1213.5" x2="1559.5" y1="1375.892" y2="1375.892"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="1225.5" y="1370.083">sklearn ensemble instance</text><polygon fill="#A80036" points="768.5,1403.598,758.5,1407.598,768.5,1411.598,764.5,1407.598" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="762.5" x2="1202.5" y1="1407.598" y2="1407.598"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="774.5" y="1401.789">ensemble estimator</text><polygon fill="#A80036" points="522.5,1442.304,512.5,1446.304,522.5,1450.304,518.5,1446.304" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="516.5" x2="751.5" y1="1446.304" y2="1446.304"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="528.5" y="1440.495">sklearn estimator (unfitted)</text><polygon fill="#A80036" points="34.5,1474.0101,24.5,1478.0101,34.5,1482.0101,30.5,1478.0101" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="505.5" y1="1478.0101" y2="1478.0101"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="40.5" y="1472.2011">sklearn estimator (unfitted)</text><!--MD5=[a8d9b9edfbe35860946375a4504fea36]
@startuml
title Parser and Compiler Sequence Diagram

actor User

participant "DSLParser" as Parser
participant "dsl_to_sklearn_estimator()" as CompilerAPI
participant "compile_ast_to_estimator()" as Compiler
participant "build_model()" as ModelBuilder
participant "build_vote()\nbuild_stack()\nbuild_bag()\nbuild_ada()" as EnsembleBuilder
participant "MODEL_REGISTRY\nENSEMBLE_REGISTRY" as Registry
participant "sklearn Estimator" as Estimator

== Parse DSL String to AST ==
User -> Parser : parse(dsl_string)
activate Parser

Parser -> Parser : _setup_grammar()\n(if first call)
Parser -> Parser : grammar.parseString(dsl_string)
Parser -> Parser : _make_call_node() or\n_make_literal_node()

Parser - -> User : ast_node (dict)\n{type: "call", name: "...", pos: [...], kw: {...}}
deactivate Parser

== Compile DSL String to Estimator ==
User -> CompilerAPI : dsl_to_sklearn_estimator(dsl_string)
activate CompilerAPI

CompilerAPI -> Parser : parse_dsl_to_ast(dsl_string)
activate Parser
Parser - -> CompilerAPI : ast_node (dict)
deactivate Parser

CompilerAPI -> Compiler : compile_ast_to_estimator(ast_node)
activate Compiler

alt Node is a Model (LR, SVM, RF, DT, NB)
    Compiler -> ModelBuilder : build_model(name, kw_nodes, context)
    activate ModelBuilder
    
    ModelBuilder -> ModelBuilder : eval_value() for each kw arg
    ModelBuilder -> Registry : MODEL_REGISTRY[name]
    Registry - -> ModelBuilder : sklearn class
    ModelBuilder -> ModelBuilder : safe_kwargs_for()\n(validate parameters)
    ModelBuilder -> ModelBuilder : Apply special rules\n(e.g., LR penalty/solver)
    ModelBuilder -> Estimator : cls(**kw)
    Estimator - -> ModelBuilder : sklearn estimator instance
    ModelBuilder - -> Compiler : estimator
    deactivate ModelBuilder

else Node is Ensemble (vote, stack, bag, ada)
    Compiler -> EnsembleBuilder : build_* (pos_nodes, kw_nodes, context)
    activate EnsembleBuilder
    
    loop For each base estimator in pos_nodes
        EnsembleBuilder -> Compiler : compile_ast_to_estimator(child_node, context)
        activate Compiler
        Compiler - -> EnsembleBuilder : base_estimator
        deactivate Compiler
    end
    
    EnsembleBuilder -> EnsembleBuilder : eval_value() for options
    EnsembleBuilder -> Registry : ENSEMBLE_REGISTRY[name]
    Registry - -> EnsembleBuilder : sklearn ensemble class
    EnsembleBuilder -> EnsembleBuilder : safe_kwargs_for()\n(validate parameters)
    EnsembleBuilder -> Estimator : EnsembleClass(estimators=[...], **options)
    Estimator - -> EnsembleBuilder : sklearn ensemble instance
    EnsembleBuilder - -> Compiler : ensemble estimator
    deactivate EnsembleBuilder
end

Compiler - -> CompilerAPI : sklearn estimator (unfitted)
deactivate Compiler
CompilerAPI - -> User : sklearn estimator (unfitted)
deactivate CompilerAPI

@enduml

PlantUML version 1.2021.00(Sun Jan 10 10:25:05 GMT 2021)
(MIT source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>